/*! flickrgal 2016-10-08 */
function $(a){return document.querySelector(a)}function handle_click(a){var b=a.currentTarget,c=b.className;switch(console.log(c),c){case"navigate-back":imageGrid.innerHTML="";for(var d in prevState)imageGrid.appendChild(prevState[d]);console.log("yip"),loading.style.display="none";break;case"album":var e=b.id;insert_images(e);break;case"image":var f=b.id,g=b.getAttribute("album-id");insert_lightbox(f,g),lightbox.classList.remove("hide"),console.log("yip");break;case"close":lightbox.classList.add("hide");break;case"prev":prev();break;case"next":next()}}function handle_keys(a){var b=a.keyCode;switch(b){case 39:next();break;case 37:prev();break;case 27:lightbox.classList.add("hide")}}function prev(){var a=document.getElementById(lightboxSet[0]);a.classList.add("hide-stage-image");var b=lightboxSet.pop();lightboxSet.unshift(b),a=document.getElementById(lightboxSet[0]),a.classList.remove("hide-stage-image"),lightbox.title.innerHTML=a.getAttribute("data-title"),lightbox.desc.innerHTML=a.getAttribute("data-description")}function next(){var a=document.getElementById(lightboxSet[0]);a.classList.add("hide-stage-image");var b=lightboxSet.shift();lightboxSet.push(b),a=document.getElementById(lightboxSet[0]),a.classList.remove("hide-stage-image"),lightbox.title.innerHTML=a.getAttribute("data-title"),lightbox.desc.innerHTML=a.getAttribute("data-description")}function Element(a){this.el=document.createElement("div"),this.el.className=a,this.loading=document.createElement("div"),this.loading.className="image-loading",this.inner=document.createElement("div"),this.inner.className="inner",this.dummy=document.createElement("div"),this.dummy.className="dummy",this.title=document.createElement("div"),this.desc=document.createElement("div")}function make_request(a,b,c){var d=new XMLHttpRequest;d.open("GET",a,!0),d.requestType=b,d.requestID=c,d.onload=handle_request,d.send()}function handle_request(a){var b=a.target,c=JSON.parse(b.responseText),d=b.requestType,e=b.requestID;if(b.readyState===XMLHttpRequest.DONE)if(200===b.status)switch(console.log(d+" request succeed"),console.log("Response JSON:"),console.log(c),d){case"collections":build_collections(c);var f=imageGrid.childNodes;Array.prototype.forEach.call(f,function(a){prevState.push(a)}),console.log(prevState);break;case"photosets":insert_albums(c,e)}else console.log("Flickr "+requestType+" request failed!")}function get_album_pos(a){var b="";for(var c in albums)albums[c].id==a&&(b=c);return b}function to_lower_case(a){for(name in a)a[name]=a[name].toString().toLowerCase();return a}function fade_in_image(a,b){var c=document.getElementById(a);c.style.backgroundImage="url("+b+")";var d=c.querySelector(".image-loading");!!d&&(d.style.opacity=0)}function build_image_url(a,b){var c="https://farm"+a.farm+".staticflickr.com/"+a.server+"/"+a.id+"_"+a.secret+"_"+b+".jpg";return c}function build_album(a,b,c){var d=a.set;for(set in d)albums.push({id:d[set].id,collectionName:b,collectionID:c,title:d[set].title,description:d[set].description,images:[]});setHasTitles&&imageGrid.insertAdjacentHTML("beforeend",'<h3 class="collection-title">'+b+'</h3><div class="collection collection-'+c+'"></div>')}function build_collections(a){var b=a.collections.collection;for(collection in b){var c=b[collection],d=c.title,e=c.id;getAll?build_album(c,d,e):set.indexOf(d.toLowerCase())>=0&&build_album(c,d,e)}loading.style.display="none",Array.prototype.forEach.call(albums,function(a){var b=new Element("album");b.el.id=a.id,b.title.innerHTML=a.title,b.el.setAttribute("collection-name",a.collectionName),b.el.setAttribute("collection-id",a.collectionID),b.inner.appendChild(b.title),b.el.appendChild(b.loading),b.el.appendChild(b.dummy),b.el.appendChild(b.inner),b.el.addEventListener("click",handle_click),setHasTitles?imageGrid.querySelector(".collection-"+b.el.getAttribute("collection-id")).appendChild(b.el):imageGrid.appendChild(b.el)}),Array.prototype.forEach.call(albums,function(a){var b=endpoint+methodPhotos+"&photoset_id="+a.id+params+"&extras=description";make_request(b,"photosets",a.id)}),gallery.classList.remove("hide")}function insert_albums(a,b){var c=get_album_pos(b),d=a.photoset.photo;Array.prototype.forEach.call(d,function(a){var d,e={};e.id=a.id,e.farm=a.farm,e.server=a.server,e.secret=a.secret,e.title=a.title,e.description=a.description,e.is_primary=a.isprimary,albums[c].images.push(e),1==e.is_primary?(d=build_image_url(e,"z"),fade_in_image(b,d)):(d=build_image_url(albums[c].images[0],"z"),fade_in_image(b,d))})}function insert_images(a){imageGrid.innerHTML="";var b=new Element("image");b.inner.classList.remove("inner"),b.inner.classList.add("navigate-back"),b.inner.innerHTML="<div>Back</div>",b.inner.addEventListener("click",handle_click),b.el.appendChild(b.dummy),b.el.appendChild(b.inner),imageGrid.appendChild(b.el);var c=get_album_pos(a),d=albums[c].images;Array.prototype.forEach.call(d,function(b){var c=build_image_url(b,"z"),d=new Element("image"),e=b.id;d.el.id=e,d.el.setAttribute("album-id",a),d.el.appendChild(d.dummy),d.el.appendChild(d.inner),d.el.addEventListener("click",handle_click),imageGrid.appendChild(d.el),fade_in_image(e,c)})}function insert_lightbox(a,b){lightboxSet=[];var c=get_album_pos(b),d=albums[c].images,e="stage-"+a;lightbox.image.innerHTML="",Array.prototype.forEach.call(d,function(a){var b=document.getElementById(a.id),c=b.style.backgroundImage,d=document.createElement("div");d.id="stage-"+a.id,d.classList.add("hide-stage-image"),d.style.backgroundImage=c,d.setAttribute("data-title",a.title),d.setAttribute("data-description",a.description._content),largeImageUrl=build_image_url(a,"b"),d.innerHTML='<div style="background-image: url('+largeImageUrl+')"></div>',lightbox.image.appendChild(d),lightboxSet.push(d.id)});var f=lightboxSet.indexOf(e),g=lightboxSet.slice(f),h=lightboxSet.slice(0,f);lightboxSet=g.concat(h),lightbox.title.innerHTML=document.getElementById(lightboxSet[0]).getAttribute("data-title"),lightbox.desc.innerHTML=document.getElementById(lightboxSet[0]).getAttribute("data-description"),document.getElementById(e).classList.remove("hide-stage-image")}var flickrApiKey="35ca9893a15649318240594ad7dd98e7",flickrUserId="141088533@N02",endpoint="https://api.flickr.com/services/rest/?method=",params="&format=json&nojsoncallback=1&api_key="+flickrApiKey+"&user_id="+flickrUserId,methodCollection="flickr.collections.getTree",methodPhotos="flickr.photosets.getPhotos",albums=[],lightboxSet=[],prevState=[],lightboxTemplate=document.createElement("div");lightboxTemplate.id="lightbox",lightboxTemplate.className="hide";var lightboxUi=document.createElement("div");lightboxUi.id="lightbox-ui";var imageStageEl=document.createElement("div");imageStageEl.id="stage";var lightboxControls='<div class="close" title="Close (Esc)"></div><div id="controls"><div id="arrow-left" class="prev" title="Prev"></div><div id="arrow-right" class="next" title="Next"></div></div>',infoEl='<div id="info_container"><div id="info"><div id="title"></div><div id="description"></div></div></div>',imageBoxEl='<div id="image-box-container"><div><div id="image-box"></div></div></div>';lightboxUi.innerHTML=lightboxControls+infoEl,imageStageEl.innerHTML=imageBoxEl,lightboxTemplate.appendChild(lightboxUi),lightboxTemplate.appendChild(imageStageEl);var gallery=$("#flickrgal");if(gallery){gallery.className="hide";var loadingGallery='<div id="loading-gallery"><div>Loading...</div></div>',imageGridBox='<div id="image-grid"></div>',getAll,set=to_lower_case(JSON.parse(gallery.getAttribute("data-collections")));getAll=set.indexOf("all")>=0;var setHasTitles=!!gallery.hasAttribute("data-titles");gallery.insertAdjacentHTML("afterbegin",loadingGallery),gallery.insertAdjacentHTML("beforeend",imageGridBox),gallery.appendChild(lightboxTemplate);var imageGrid=$("#image-grid"),lightbox=$("#lightbox");lightbox.image=$("#image-box"),lightbox.title=$("#info > #title"),lightbox.desc=$("#info > #description");var loading=$("#loading-gallery");[].forEach.call(document.querySelectorAll(".close,.prev,.next"),function(a){a.addEventListener("click",handle_click)}),window.addEventListener("keydown",handle_keys),console.log("Requested Collections: "+set);var url=endpoint+methodCollection+params;make_request(url,"collections")}